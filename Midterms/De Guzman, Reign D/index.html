<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Task Manager</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            max-width: 1250px;
            margin: 40px auto;
            padding: 20px;
            background-color: #eef2f5;
            font-size: 18px;
            color: #333;
        }

        header {
            text-align: center;
            margin-bottom: 20px;
        }

        .task-form {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        input, select, textarea {
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            flex: 1;
            font-size: 1rem;
            font-family: inherit;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        #taskInput, #taskDesc {
            flex-basis: 100%;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 8px rgba(0,123,255,0.2);
        }

        button {
            padding: 12px 24px;
            font-size: 1rem;
            font-weight: 600;
            background-color: #007bff; 
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        button:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        .task-form button {
            flex-basis: 100%;
            margin-top: 15px;
            font-size: 1.2rem; 
            padding: 15px;
        }

        textarea {
            width: 100%;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            resize: vertical; 
            min-height: 80px;
            font-family: inherit;
        }

        table {
            width: 100%;
            border-collapse: collapse; /* Removes space between borders */
            margin-top: 20px;
            background-color: transparent;
        }

        /* Header Styling */
        thead tr {
            background-color: #fff;
            border-bottom: 2px solid #eee;
        }

        th {
            padding: 20px;
            text-align: left;
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 0.5px;
            color: #555;
            font-weight: 600;
        }

        /* Row Styling */
        tbody tr {
            background: white;
            border-bottom: 1px solid #f0f0f0;
            transition: background-color 0.2s;
        }

        tbody tr:hover {
            background-color: #f9f9f9;
        }

        /* Cell Styling */
        td {
            padding: 20px;
            vertical-align: middle;
            font-size: 1.05rem;
        }

        /* Text Colors */
        .text-high { color: #dc3545; font-weight: bold; }
        .text-medium { color: #ffc107; font-weight: bold; }
        .text-low { color: #28a745; font-weight: bold; }

        /* Buttons */
        .btn-group { display: flex; gap: 5px; }
        .delete-btn { background-color: #dc3545; }
        .delete-btn:hover { background-color: #c82333; }
        .edit-btn { background-color: #ffc107; color: black; }
        .edit-btn:hover { background-color: #e0a800; transform: scale(1.05); }
        .done-btn { background-color: #28a745; }
        .done-btn:hover { background-color: #218838; transform: scale(1.05); } 

        /* Completed State */
        .completed-task {
            opacity: 0.6;
            background-color: #e9ecef !important; 
        }
        .completed-task td {
            text-decoration: line-through;
            color: #6c757d;
        }
        /* Keep buttons clickable/visible */
        .completed-task td:last-child {
             text-decoration: none; 
        }
    </style>
</head>
<body>

    <header>
        <h1>Student Task Manager</h1>
        <p id="currentDateDisplay"></p> 
    </header>

    <main>
        <section class="task-form">
            <input type="text" id="taskInput" placeholder="Task Title" required>
            
            <textarea id="taskDesc" placeholder="Task Description" required></textarea>

            <select id="prioritySelect">
                <option value="Select Priority" disabled selected>Select Priority</option> 
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
            
            <input type="date" id="dateInput">
            
            <!-- SAVE BUTTON -->
            <button id="addBtn">Save Task</button>
        </section>

        <section>
            <!-- TABLE STRUCTURE -->
            <table id="taskMainTable">
                <thead>
                    <tr>
                        <th style="width: 20%;">Title</th>
                        <th style="width: 30%;">Description</th>
                        <th style="width: 10%;">Priority</th>
                        <th style="width: 15%;">Due Date</th>
                        <th style="width: 10%;">Status</th>
                        <th style="width: 15%;">Actions</th>
                    </tr>
                </thead>
                <tbody id="taskList">
                    </tbody>
            </table>
        </section>
    </main>

    <script>
        // JAVASCRIPT VARIABLES
        const addBtn = document.getElementById('addBtn');
        const taskInput = document.getElementById('taskInput');
        const taskDesc = document.getElementById('taskDesc');
        const prioritySelect = document.getElementById('prioritySelect');
        const dateInput = document.getElementById('dateInput');
        // This now selects the TBODY
        const taskList = document.getElementById('taskList');
        const currentDateDisplay = document.getElementById('currentDateDisplay');

        let editingRow = null; 

        const todayDate = new Date();
        currentDateDisplay.innerText = todayDate.toDateString();

        // Note: Removed the initial innerHTML setting because the header is now static in HTML

        addBtn.addEventListener('click', function(e) {
            e.preventDefault(); 

            const title = taskInput.value.trim();
            const desc = taskDesc.value.trim();
            const priority = prioritySelect.value;
            const dateVal = dateInput.value;

            if (title === '' || desc === '') {
                alert('Please fill in Title and Description!');
                return;
            }
            if (!dateVal) {
                alert('Please select a due date!');
                return;
            }

            const selectedDate = new Date(dateVal);
            const today = new Date();
            today.setHours(0, 0, 0, 0); 
            
            if (selectedDate < today) {
                alert('Due date cannot be in the past!');
                return;
            }

            if (priority === "Select Priority") {
                 alert('Please select a priority!');
                 return;
            }

            // --- CREATE / UPDATE ROW CONTENT ---
            const priorityClass = priority === 'high' ? 'text-high' : (priority === 'medium' ? 'text-medium' : 'text-low');
            const priorityLabel = priority.charAt(0).toUpperCase() + priority.slice(1);

            // CHANGED divs to tds for table cells
            const rowContent = `
                <td>${title}</td>
                <td>${desc}</td>
                <td><span class="${priorityClass}" data-priority="${priority}">${priorityLabel}</span></td>
                <td>${dateVal}</td>
                <td class="status-cell">Pending</td>
                <td>
                     <div class="btn-group">
                        <button class="edit-btn">Edit</button>
                        <button class="delete-btn">Delete</button>
                        <button class="done-btn">âœ”</button>
                    </div>
                </td>
            `;

            if (editingRow) {
                // UPDATE EXISTING ROW
                editingRow.innerHTML = rowContent;
                editingRow = null; 
                addBtn.innerText = "Save Task";
                addBtn.style.backgroundColor = "#007bff"; 
            } else {
                // CREATE NEW ROW (Changed 'li' to 'tr')
                const tr = document.createElement('tr');
                tr.innerHTML = rowContent;
                taskList.appendChild(tr);
            }

            // Clear inputs
            taskInput.value = '';
            taskDesc.value = '';
            prioritySelect.selectedIndex = 0;
            dateInput.value = '';

            // SORT TASKS
            sortTasks();
        });

        // FUNCTION: SORT TASKS
        function sortTasks() {
            // Select all rows in the TBODY
            const rows = Array.from(taskList.querySelectorAll('tr'));
            
            rows.sort((a, b) => {
                // 1. Sort by Priority
                const pA = getPriorityValue(a);
                const pB = getPriorityValue(b);
                if (pA !== pB) return pB - pA; 

                // 2. Sort by Date
                const dA = new Date(getDateValue(a));
                const dB = new Date(getDateValue(b));
                return dA - dB; 
            });

            // Re-append sorted rows
            rows.forEach(row => taskList.appendChild(row));
        }

        function getPriorityValue(row) {
            // Find the span inside the priority cell (index 2)
            const p = row.children[2].querySelector('[data-priority]').dataset.priority;
            if (p === 'high') return 3;
            if (p === 'medium') return 2;
            return 1;
        }

        function getDateValue(row) {
            // Date is in index 3
            return row.children[3].innerText;
        }

        // FUNCTION: HANDLE BUTTON CLICKS (Event Delegation)
        taskList.addEventListener('click', function(e) {
            const item = e.target;
            // Changed closest('li') to closest('tr')
            const tr = item.closest('tr');
            if (!tr) return;

            // DELETE TASK
            if (item.classList.contains('delete-btn')) {
                if (confirm("Are you sure you want to delete this task?")) {
                    tr.remove();
                }
            }

            // TOGGLE COMPLETE
            if (item.classList.contains('done-btn')) {
                const statusCell = tr.children[4];
                
                if (statusCell.innerText === "Pending") {
                    statusCell.innerText = "Completed";
                    tr.classList.add('completed-task'); 
                } else {
                    statusCell.innerText = "Pending";
                    tr.classList.remove('completed-task');
                }
            }

            // EDIT TASK
            if (item.classList.contains('edit-btn')) {
                const cols = tr.children;
                taskInput.value = cols[0].innerText;
                taskDesc.value = cols[1].innerText;
                
                // Priority (find the data attribute in the span)
                const pVal = cols[2].querySelector('[data-priority]').dataset.priority;
                prioritySelect.value = pVal;

                dateInput.value = cols[3].innerText;

                // Set Edit Mode
                editingRow = tr;
                addBtn.innerText = "Update Task";
                addBtn.style.backgroundColor = "#ffc107"; 
                addBtn.style.color = "black";

                document.querySelector('.task-form').scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>